# MySQL 模式的事务隔离级别

## MySQL 模式支持的隔离级别

OceanBase 数据库在 MySQL 模式下，支持三种隔离级别：

* 读已提交（Read Committed）：一个事务执行的查询，只能看到这次查询开始之前提交的数据。读已提交无法防止不可重复读和幻读两种异常情况。如果冲突的事务比较少，简单高效的读已提交隔离级别对应用来说是足够的。

* 可重复读（Repeatable Read）：事务内不同时间读到的同一批数据是一致的。

* 可串行化（Serializable）：该隔离级别类似 Oracle 数据库的 Serializable，并非严格意义上的 Serializable。

OceanBase 数据库默认的隔离级别为**读已提交（Read Committed）**。

## 隔离级别行为对比

MySQL 数据库支持**读未提交**、**读已提交**、**可重复读**和**可串行化**四种隔离级别，OceanBase 数据库的 MySQL 模式在这四种隔离级别上与 MySQL 数据库均有一定差异。

* **读未提交**：
  MySQL 数据库支持**读未提交**，而 OceanBase 数据库不支持**读未提交**。

* **读已提交**：
  MySQL 数据库和 OceanBase 数据库在**读已提交**隔离级别下判断行是否满足更新条件时的不同行为。MySQL 数据库使用半一致性读，等待并发事务结束后判断最新版本；而 OceanBase 数据库基于语句快照判断，等待并发事务结束后重试以获取最新快照。

* **可重复读**：
  MySQL 数据库和 OceanBase 数据库在可重复读隔离级别下在判断行是否满足更新条件和处理写冲突时具有不同的行为。MySQL 数据库中，后续写的事务会等待先前写的事务提交后再进行更新。相比之下，OceanBase 数据库在后续写的事务中会回滚并返回错误，避免了写冲突的影响。此外，MySQL 数据库的可重复读隔离级别可能会导致一些行为上不符合直觉的情况。而 OceanBase 数据库通过回滚事务来避免这些不符合预期的情况。

* **可串行化**：
  MySQL 数据库的**可串行化**隔离级别使用两阶段锁（2PL），能够保证严格的可串行化；OceanBase 数据库的**可串行化**隔离级别使用快照隔离（Snapshot Isolation），不能保证严格的可串行化。

## 隔离级别设置方法

设置隔离级别有两种方式，分别为 Global 级别和 Session 级别。

```sql
SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL [READ COMMITTED | REPEATABLE READ | SERIALIZABLE];
```

## 隔离级别使用限制

* 不能在事务执行过程中设置隔离级别，否则会报如下错误：

    ```sql
    ERROR 1568 (25001): Transaction characteristics can't be changed while a transaction is in progress
    ```

* Global 级别的隔离级别可以被 Session 级别的隔离级别覆盖。
