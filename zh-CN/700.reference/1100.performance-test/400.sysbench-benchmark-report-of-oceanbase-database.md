|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# OceanBase Sysbench 性能测试报告

## 测试环境 (阿里云 ECS)

* 硬件配置  

    | 服务类型 | ECS 类型 | 实例数 | 机器核心数 | 内存 |
    | --- | --- | --- | --- | --- |
    | OceanBase 数据库 | ecs.g7.8xlarge | 3 | 32C | 128G <br>每台机器系统盘 300G，再挂载两块 400G 云盘作为 Clog 盘和 Data 盘，性能级别为 PL1|
    | Sysbench | ecs.c7.4xlarge | 1 | 16c | 32g |
    | ODP | ecs.c7.16xlarge | 1 | 64C | 128G |

* 租户规格

    ```sql
    create resource unit perf_unit max_cpu 26, memory_size '100g';
    create resource pool perf_pool unit = 'perf_unit', unit_num = 1, zone_list=('zone1','zone2','zone3');
    create tenant perf resource_pool_list=('perf_pool'), charset=utf8mb4, replica_num=3, zone_list('zone1', 'zone2', 'zone3'), primary_zone=RANDOM, locality='F@zone1,F@zone2,F@zone3' set variables ob_compatibility_mode='mysql', ob_tcp_invited_nodes='%';
    ```

* 软件版本  

    | 服务类型 | 软件版本 |
    | --- | --- |
    | OceanBase 数据库 | <ul><li>企业版：OceanBase 4.2.2.0</li><li>社区版：OceanBase_CE 4.2.2.0 </li></ul> |
    | ODP | OceanBase 4.2.3 |
    | Sysbench | 1.0.20 |
    | OS | CentOS Linux release 7.9.2009 (Core) |

## 测试方案

1. 通过 OBD 部署 OceanBase 集群，ODP 单独部署在一台机器上。

2. OceanBase 集群规模为 1：1：1，部署成功后先新建跑 Sysbench 测试的租户及用户（sys 租户是管理集群的内置系统租户，请勿直接使用 sys 租户进行测试），设置租户的 `primary_zone` 为 RANDOM，RANDOM 表示新建表分区的 leader 随机到这 3 台机器。

3. 启动 Sysbench 客户端，进行 `point_select`、`read_write`、`read_only` 和 `write_only` 测试。

4. 每轮测试 `--time` 设置为 60s，线程数取值可以为 `32/64/128/256/512/1024`。

### 测试规格

```shell
--mysql-db=test 
--table_size=1000000 
--tables=30 
--threads=32/64/128/256/512/1024 
--report-interval=1
--time=30
--db-ps-mode=disable
--rand-type=uniform
```

## 测试结果

### Point Select 性能

| Threads | zone1  QPS/95%rt | RANDOM QPS/95%rt |
| --- | --- | --- |
| 32 | 144562.71/0.26 | 150002.69/0.24 |
| 64 | 255157.22/0.30 | 279256.71/0.27 |
| 128 | 380483.96/0.51 | 489197.56/0.30 |
| 256 | 505118.71/0.90 | 791088.58/0.46 |
| 512 | 589809.56/1.42 | 1041150.67/0.83 |
| 1024 | 600025.98/3.30 | 1053486.24/2.18 |

### Read Only 性能

| Threads | zone1  QPS/95%rt | RANDOM QPS/95%rt |
| --- | --- | --- |
| 32 | 124411.49/4.49 | 131753.27/4.18 |
| 64 | 209992.12/5.57 | 241825.11/4.65 |
| 128 | 283414.89/8.74 | 414202.92/5.57 |
| 256 | 317012.12/19.29 | 638432.40/7.30 |
| 512 | 337949.54/39.65 | 798094.11/15.00 |
| 1024 | 331738.82/77.19 | 798567.76/34.95 |

### Write Only 性能

| Threads | zone1  QPS/95%rt | RANDOM QPS/95%rt |
| --- | --- | --- |
| 32 | 62842.72/3.96 | 46505.45/6.09 |
| 64 | 123026.83/4.65 | 88264.25/5.99 |
| 128 | 172264.95/6.09 | 153548.94/6.43 |
| 256 | 221739.40/9.73 | 227430.99/8.74 |
| 512 | 242756.24/23.10 | 292273.10/14.46 |
| 1024 | 252565.64/36.24 | 324863.22/35.59 |

### Read Write 性能

| Threads | zone1  QPS/95%rt | RANDOM QPS/95%rt |
| --- | --- | --- |
| 32 | 95173.19/7.98 | 83309.88/9.56 |
| 64 | 164018.31/9.06 | 151101.81/10.27 |
| 128 | 222046.91/22.69 | 268784.90/11.65 |
| 256 | 272321.09/33.72 | 394488.45/15.00 |
| 512 | 298693.98/53.85 | 523029.07/31.37 |
| 1024 | 292904.80/108.68 | 598383.51/50.11 |
