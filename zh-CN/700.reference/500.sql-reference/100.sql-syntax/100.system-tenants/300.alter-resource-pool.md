# ALTER RESOURCE POOL

## 描述

`ALTER RESOURCE POOL` 语句用于修改资源池的属性，包括修改 `UNIT`、`UNIT_NUM` 和 `ZONE_LIST`。

如果需要将多个资源池合并为一个或几个资源池，可以使用 `ALTER RESOURCE POOL MERGE ... INTO` 语句。合并资源池时，要求被合并的所有资源池其 `UNIT_NUM` 的个数相等，同时资源规格也要相同。

如果需要将一个多 Zone 资源池分裂为多个单 Zone 资源池，可以使用 `ALTER RESOURCE POOL ... SPLIT INTO` 语句。

## 注意事项及使用限制

* 使用 `ALTER RESOURCE POOL` 语句修改资源池属性时，每条语句每次仅支持修改一个属性，如果需要同时修改 `UNIT`、`UNIT_NUM`、`ZONE_LIST` 中两条及以上的属性，需要分多条语句执行。

* 增大或减少 `UNIT_NUM` 时，如果资源池已经被租户使用，则不能使用 `ALTER RESOURCE POOL` 语句，需要使用 `ALTER RESOURCE TENANT` 语句进行修改。有关 `ALTER RESOURCE TENANT` 语句的详细介绍，请参见 [ALTER RESOURCE TENANT](300.alter-resource-tenant.md)。

* 合并资源池时，不会影响资源池被租户使用，仅在 Root Service 的管理层看来是多个资源池合并为一个资源池，方便统一维护。

## 权限要求

仅 `sys` 租户的 `root` 用户（`root@sys`）可以修改资源池，其他租户不支持修改资源池。

## 语法

### ALTER RESOURCE POOL

```sql
ALTER RESOURCE POOL pool_name 
      UNIT [=] unit_name
    | UNIT_NUM [=] unit_num [DELETE UNIT = (unit_id_list)]
    | ZONE_LIST [=] ('zone_name' [, 'zone_name' ...]);
```

### ALTER RESOURCE POOL MERGE ... INTO

```sql
ALTER RESOURCE POOL 
    MERGE ('pool_name'[, 'pool_name' ...]) 
    INTO ('merge_pool_name'[, 'merge_pool_name' ...]);
```

### ALTER RESOURCE POOL ... SPLIT INTO

```sql
ALTER RESOURCE POOL pool_name 
    SPLIT INTO ('pool_name' [, 'pool_name' ...]) 
    ON ('zone_name' [, 'zone_name' ...]);
```


## 参数解释

|                  **参数**                 |                    **描述**                                                                  |
|-------------------------------------------|----------------------------------------------------------------------------------------------|
| unit_name                                 | 修改资源池要使用的资源规格名称。                                                                |
| unit_num                                  | 指定修改后单个 Zone 下 Unit 的个数。增大 `unit_num` 时，其值需要小于等于目标 Zone 内节点的个数。   |
| unit_id_list                              | 减小 `unit_num` 时，使用 `DELETE UNIT` 可以删除指定的 Unit。 不指定 `DELETE UNIT` 时，系统将自动选择 Unit 进行删除。 <main id="notice" type=notice'><h4>注意</h4><p>使用 <code>DELETE UNIT</code> 删除指定的 <code>unit_id</code> 时，还需要满足以下条件： <ul><li> 删除的 <code>unit_id</code> 列表中，每个 Zone 内删除的 Unit 个数必须相等。</li>   <li> 待删除的 <code>unit_id</code> 列表中，每个 Zone 内删除的 Unit 个数需要与指定的 <code>unit_num</code> 一致。</li></ul> </p></main>    |
| ZONE_LIST                                 | 指定修改后资源池的 Zone 列表。                                                                 |
| merge_pool_name                           | 合并后的资源池名称。                                                                           |

## 示例

* 不能同时修改资源池 `pool1` 的多个属性，例如以下语句同时修改了 `UNIT`、`UNIT_NUM` 与 `ZONE` 属性，执行将报错。

  ```sql
  obclient [oceanbase]> ALTER RESOURCE POOL pool1 UNIT='unit2', UNIT_NUM=1, ZONE_LIST=('zone1');
  ERROR 1235 (0A000): alter unit_num, resource_unit, zone_list in one cmd not supported
  ```

  特别地，在减小 `UNIT_NUM` 时，可以删除指定的 Unit。

  ```sql
  obclient [oceanbase]> ALTER RESOURCE POOL pool1 UNIT_NUM=1 DELETE UNIT = (1002);
  ```

* 将资源池 `pool1` 所使用的资源规格修改为 `unit2`。

  ```sql
  obclient [oceanbase]> ALTER RESOURCE POOL pool1 UNIT='unit2';
  ```

* 将资源池 `pool1` 分裂成 `pool10` 和 `pool11`。

  假设原资源池 `pool1` 的创建语句如下所示。

  ```sql
  obclient [oceanbase]> CREATE RESOURCE POOL pool1 unit='unit1',unit_num=1,zone_list=('zone1','zone2');
  ```
  
  则分裂资源池的语句如下。

  ```sql
  obclient [oceanbase]> ALTER RESOURCE POOL pool1 SPLIT INTO ('pool10','pool11') ON ('zone1','zone2');
  ```

* 假设 `tenant1` 租户使用了三个资源池，分别为 `pool0`、`pool1` 与 `pool2` ，现将三个资源池合并统一管理。

  ```sql
  obclient [oceanbase]> ALTER RESOURCE POOL MERGE ('pool0','pool1','pool2') INTO ('pool3');
  ```

## 相关文档

* [查看资源池](../../../../600.manage/200.tenant-management/600.common-tenant-operations/1500.resource-pool-management/100.view-resource-pools.md)

* [修改资源池属性](../../../../600.manage/200.tenant-management/600.common-tenant-operations/900.modify-resource-pool-properties.md)

* [合并和分裂资源池](../../../../600.manage/200.tenant-management/600.common-tenant-operations/1500.resource-pool-management/500.merge-and-splitting-resource-pools.md)

