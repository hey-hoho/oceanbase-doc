# ALTER RESOURCE POOL

## 描述

当资源池未分配给租户时，可以使用 `ALTER RESOURCE POOL` 语句用于修改资源池的属性。如果待修改的资源池已经被租户使用，需要使用 `ALTER RESOURCE TENANT` 语句进行修改。有关 `ALTER RESOURCE TENANT` 语句的详细介绍，请参见 [ALTER RESOURCE TENANT](300.alter-resource-tenant.md)。

如果需要将相同资源规格的多个资源池合并为一个资源池，可以使用 `ALTER RESOURCE POOL MERGE ... INTO` 语句。合并资源池时，要求被合并的所有资源池其 `UNIT_NUM` 的个数相等，并且其资源规格相同。

如果需要将一个多 Zone 资源池分裂为多个单 Zone 资源池，可以使用 `ALTER RESOURCE POOL ... SPLIT INTO` 语句。

## 注意事项及使用限制

使用 `ALTER RESOURCE POOL` 语句修改资源池属性时，每条语句每次仅支持修改一个属性，如果需要同时修改 `UNIT`、`UNIT_NUM`、`ZONE_LIST` 中两条及以上的属性，需要分多条语句执行。

## 权限要求

仅 `sys` 租户的 `root` 用户（`root@sys`）可以修改资源池，其他租户不支持修改资源池。

## 语法

### ALTER RESOURCE POOL

```sql
ALTER RESOURCE POOL 
    pool_name 
    UNIT [=] unit_name, 
    UNIT_NUM [=] unit_num [DELETE UNIT = (unit_id_list)], 
    ZONE_LIST [=] ('zone_name' [, 'zone_name' ...]);
```

### ALTER RESOURCE POOL MERGE ... INTO

```sql
ALTER RESOURCE POOL 
    MERGE ('pool_name'[, 'pool_name' ...]) 
    INTO ('merge_pool_name');
```

### ALTER RESOURCE POOL ... SPLIT INTO

```sql
ALTER RESOURCE POOL pool_name 

    SPLIT INTO ('pool_name' [, 'pool_name' ...]) 
    ON ('zone_name' [, 'zone_name' ...]);
```


## 参数解释

|                  **参数**            |                    **描述**           |
|-------------------------------------------|------------------------------------------------------------------|
| unit_name                                 | 指定要使用的资源单元配置的名称。         |
| unit_num                                  | 指定修改后一个 Zone 下的 Unit 个数，取值要小于等于对应 Zone 中的 OBServer 个数。<main id="notice" type=notice'><h4>注意</h4><p> 当资源池分配给租户之后，无法再通过 <code>ALTER RESOURCE POOL</code> 语法修改资源池 Unit 个数，需要通过 <code>ALTER RESOURCE TENANT</code> 语法，使用方法参见 <a href="300.alter-resource-tenant.md">ALTER RESOURCE TENANT</a>。</p></main>   |
| unit_id_list                              | 减小 `unit_num` 时，使用 `DELETE UNIT` 可以明确指定本次缩容即将删除的 Unit。 不指定 `DELETE UNIT` 时，系统将自动选择 Unit 进行删除。 <main id="notice" type=notice'><h4>注意</h4><p>使用 <code>DELETE UNIT</code> 明确指定删除的 <code>unit_id</code> 时需要还需要满足以下条件： <ul><li> 删除的 <code>unit_id</code> 列表中，每个 Zone 内删除的 Unit 的数量必须相等，目前认为删除列表中各 Zone 的 Unit 数量不相同的缩容操作非法。</li>   <li> 删除的 <code>unit_id</code> 列表中，每个 Zone 内删除的 Unit 的数量和 <code>unit_num</code> 的数量需要匹配。</li></ul> </p></main>    |
| ZONE_LIST | 指定资源池的 Zone 列表。   |
| MERGE                                     | 合并多个资源池。 合并资源池时，不影响资源池被租户使用，只是在 Root Service的管理层看来是多个资源池合并为一个资源池，方便统一维护。       |
| SPLIT                                     | 将资源池分裂为几个资源池。     |
| merge_pool_name                           | 合并后的资源池名称。       |

## 示例

* 不能同时修改资源池 `pool1` 的多个属性，例如以下语句同时修改了 `UNIT`、`UNIT_NUM` 与 `ZONE` 属性，执行将报错。

  ```sql
  obclient> ALTER RESOURCE POOL pool1 UNIT='unit2', UNIT_NUM=1, ZONE_LIST=('zone1');
  ERROR 1235 (0A000): alter unit_num, resource_unit, zone_list in one cmd not supported
  ```

  特别地，在减小 `UNIT_NUM` 时，可以指定删除具体的 Unit。

  ```sql
  obclient> ALTER RESOURCE POOL pool1 UNIT_NUM=1 DELETE UNIT = (1002);
  Query OK, 0 rows affected
  ```

* 修改资源池 `pool1` 的 `UNIT` 属性。

  ```sql
  obclient> ALTER RESOURCE POOL pool1 UNIT='unit2';
  Query OK, 0 rows affected
  ```

* 将资源池 `pool1` 分裂成 `pool10` 和 `pool11`。

  ```sql
  obclient> CREATE RESOURCE POOL pool1 unit='unit1',unit_num=1,zone_list=('zone1','zone2');
  Query OK, 0 rows affected
  
  
  obclient> ALTER RESOURCE POOL pool1 SPLIT INTO ('pool10','pool11') ON ('zone1','zone2');
  Query OK, 0 rows affected
  ```

* 假设 `tenant1` 租户使用了三个资源池，分别为 `pool0`、`pool1` 与 `pool2` ，现将三个资源池合并统一管理。

  ```sql
  obclient>ALTER RESOURCE POOL MERGE ('pool0','pool1','pool2') INTO ('pool3');
  Query OK, 0 rows affected
  ```
