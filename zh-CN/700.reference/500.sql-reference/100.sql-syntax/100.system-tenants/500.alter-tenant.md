# ALTER TENANT

## 描述

`ALTER TENANT` 语句用来修改用户租户的属性，包括修改 Locality、主 Zone、资源池列表以及系统变量值等。

## 使用限制及注意事项

--需要考虑主备库场景下，修改租户属性会不会造成什么影响？

* 租户被锁定后，系统将不允许用户再在该租户上创建新的连接，已存在的连接不受影响。

## 权限要求

仅 `sys` 租户的 `root` 用户（`root@sys`）可以修改租户，其他租户不支持修改租户。

## 语法

### ALTER TENANT

```sql
ALTER TENANT {tenant_name | ALL}
    [SET] [tenant_option_list] [set_sys_var];

tenant_option_list:
    tenant_option [, tenant_option ...]

tenant_option:
      LOCALITY [=] 'locality_description'
    | PRIMARY_ZONE [=] zone
    | RESOURCE_POOL_LIST [=](pool_name [, pool_name...]) 
    | ENABLE_ARBITRATION_SERVICE [=] {True | False} 
    | {CHARACTER SET | CHARSET} [=] charset_name 
    | COLLATE [=]  collation_name 
    | {READ ONLY | READ WRITE}
    | DEFAULT TABLEGROUP [=] {NULL | tablegroup_name}
    | PROGRESSIVE_MERGE_NUM [=] int_num
    | ENABLE_EXTENDED_ROWID [=] {true | false}  
    | COMMENT [=]'string'   

set_sys_var:
    VARIABLES var_name {TO | =} var_value [,var_name {TO | =} var_value...]
```

### ALTER TENANT ... RENAME----需要考虑重命名租户对租户有什么影响？

```sql
ALTER TENANT tenant_name RENAME GLOBAL_NAME TO new_tenant_name;
```

### ALTER TENANT ... LOCK/UNLOCK

```sql
ALTER TENANT tenant_name LOCK | UNLOCK;
```

## 参数说明

|          **参数**          |                                      **描述**                                                                             |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| tenant_name              | 指定要修改的租户名。`ALL` 表示修改所有租户。                                       |
| LOCALITY                 | 修改租户的 Locality。Locality 描述副本在 Zone 间的分布情况，如：`F@z1,F@z2,F@z3` 表示 `z1`、`z2` 和 `z3` 为全功能副本。</br>修改该参数时间，如果需要增加 Zone，则需要租户资源池的 `ZONE_LIST` 包含该 Zone。 |
| PRIMARY_ZONE             | 修改租户的 Primary Zone。主要支持以下取值：<ul><li>`RANDOM`：指定租户的 Primary Zone 为租户所在的所有 Zone，表示租户所在的所有 Zone 具有相同的优先级。</li> <li>zone_name：指定租户的 Primary Zone 为具体的某个 Zone。</li></ul> </br>如果创建租户时未指定 Primary Zone，则默认取值为 `RANDOM`。                     |
| RESOURCE_POOL_LIST       | 修改租户的资源池列表。</br>如果有多个资源池，要求多个资源池的 `UNIT_NUM` 个数一致。<main id="notice" type='notice'><h4>注意</h4><ul><li>同一个租户的多个资源池，其对应的 <code>ZONE_LIST</code> 相互之间不允许有交集。</li> <li>修改资源池列表时，每次仅支持增加或减少一个资源池。</li></ul></main> |
| ENABLE_ARBITRATION_SERVICE | 修改租户仲裁服务的开启状态。|
| CHARACTER SET \| CHARSET | 修改租户级的字符集，有关字符集的详细介绍，请参见 [字符集（MySQL 模式）](../200.common-tenant-of-mysql-mode/100.basic-elements-of-mysql-mode/300.character-set-and-collation-of-mysql-mode/200.character-set-of-mysql-mode.md) 和 [字符集（Oracle 模式）](../300.common-tenant-of-oracle-mode/300.basic-elements-of-oracle-mode/1000.character-set-and-collation-of-oracle-mode.md)。   |
| COLLATE                  | 修改租户级的字符序，有关字符序的详细介绍，请参见 [字符序（MySQL 模式）](.../200.common-tenant-of-mysql-mode/100.basic-elements-of-mysql-mode/300.character-set-and-collation-of-mysql-mode/300.collation-of-mysql-mode.md) 和 [字符序（Oracle 模式）](../300.common-tenant-of-oracle-mode/300.basic-elements-of-oracle-mode/1000.character-set-and-collation-of-oracle-mode.md)。  |
| READ ONLY \| READ WRITE  | 修改租户的属性为只读还是读写。|
| DEFAULT TABLEGROUP       | 修改租户的默认表组信息。                                                   |
| PROGRESSIVE_MERGE_NUM    | 指定新建一张表时默认对表数据进行渐进合并的次数。|
| ENABLE_EXTENDED_ROWID    | 指定是否将表创建为 Extended ROWID 模式。|
| system_var_name          | 修改租户的系统变量值。                                                                      |
| RENAME GLOBAL_NAME TO    | 修改租户名称。                                                                          |
| COMMENT                  | 修改注释。                                                                              |

## 示例

* 修改租户 `tenant1` 的 Primary Zone 为 `zone2`。

  ```sql
  obclient> ALTER TENANT tenant1 primary_zone='zone2';
  Query OK, 0 rows affected
  ```

* 不可直接替换租户的资源池，否则将出现以下错误。

  ```sql
  obclient> ALTER TENANT tenant1 resource_pool_list=('pool2');
  ERROR 1210 (HY000): Incorrect arguments to resource pool list
  ```

  如果您希望对租户进行扩容，可以修改资源单元的规格。

  ```sql
  obclient> ALTER RESOURCE UNIT unit1 MAX_CPU 15, MEMORY_SIZE '20G', MAX_IOPS 1280, MIN_CPU=10, MIN_IOPS=1024;
  Query OK, 0 rows affected
  ```

* 修改租户 `tenant1` 的 Locality，增加副本数。其中 `F` 表示副本类型为全功能型副本，`B_4` 为新增的 Zone 名称。

  ```sql
  obclient> CREATE RESOURCE UNIT unit1, MAX_CPU=5, MIN_CPU=2.5, MEMORY_SIZE= 34359738368, MAX_IOPS=10000, MIN_IOPS=5000, LOG_DISK_SIZE=5301023539200;
  Query OK, 0 rows affected
  
  obclient> CREATE RESOURCE POOL pool1 unit='unit1',unit_num=1,zone_list=('B_4');
  Query OK, 0 rows affected
  
  obclient> ALTER TENANT tenant1 resource_pool_list=('sys_pool','sys_pool1');
  Query OK, 0 rows affected
  
  obclient> ALTER TENANT tenant1 locality="F@B_1,F@B_2,F@B_3,F@B_4";
  Query OK, 0 rows affected
  ```

* 修改普通租户的名称。

  ```sql
  obclient> ALTER TENANT tenant1 RENAME GLOBAL_NAME TO tenant101;
  Query OK, 0 rows affected
  ```
