|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# oceanbase.CDB_WR_SQLSTAT

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.2.2 版本开始引入。</p>
</main>

## 功能描述

视图 `CDB_WR_SQLSTAT` 用于展示所有租户执行过的 SQL 的基本性能统计数据。

## 字段说明

| **字段名称**                  | **类型**            | **是否可以为 NULL** | **描述**                               |
|-------------------------------|---------------------|---------------------|----------------------------------------|
| TENANT_ID                     | bigint(20)          | NO   |    租户 ID |
| SNAP_ID                       | bigint(20)          | NO   |    快照 ID  |
| SVR_IP                        | varchar(46)         | NO   |    节点 IP |
| SVR_PORT                      | bigint(20)          | NO   |    节点端口号     |
| SQL_ID                        | varchar(32)         | NO   |    SQL 语句 ID   |
| PLAN_HASH                     | bigint(20) unsigned | NO   |    执行计划的 Hash 值   |
| PLAN_ID                       | bigint(20)          | NO   |    执行计划 ID   |
| PLAN_TYPE                     | bigint(20)          | NO   |    对于 SQL 计划的缓存，该字段表示计划的类型：<ul><li>`1`：表示 Local Plan </li> <li>`2`：表示 Remote Plan</li> <li>`3`：表示 Distributed Plan </li></ul> </br>对于 PL 对象缓存，该字段表示 PL 对象的类型：<ul><li>`1`：表示 Procedure</li> <li>`2`：表示 Function</li> <li>`3`：表示 Package</li> <li>`4`：表示 Anonymous Block </li></ul> |
| MODULE                        | varchar(64)         | YES  |   该语句第一次被解析时的应用程序 Module    |--看不懂
| ACTION                        | varchar(64)         | YES  |   该语句第一次被解析时的应用程序 Action      |--看不懂
| PARSING_DB_ID                 | bigint(20)          | NO   |   语句解析时的数据库 ID    |
| PARSING_DB_NAME               | varchar(128)        | NO   |   语句解析时的数据库名称     |
| PARSING_USER_ID               | bigint(20)          | NO   |   语句解析时的用户 ID     |
| EXECUTIONS_TOTAL              | bigint(20)          | NO   |   计划缓存中该计划总执行次数     |
| EXECUTIONS_DELTA              | bigint(20)          | NO   |   计划缓存中该计划总执行次数增量      |--？看不懂
| DISK_READS_TOTAL              | bigint(20)          | NO   |   读磁盘的总次数 |
| DISK_READS_DELTA              | bigint(20)          | NO   |   读磁盘次数的增量 |--？不太理解
| BUFFER_GETS_TOTAL             | bigint(20)          | NO   |   从缓存中逻辑读的总次数       |
| BUFFER_GETS_DELTA             | bigint(20)          | NO   |   从缓存中逻辑读次数的增量      |
| ELAPSED_TIME_TOTAL            | bigint(20)          | NO   |   该语句消耗的总时间。对于并行执行场景，该值为每个执行线程的累加值。          |
| ELAPSED_TIME_DELTA            | bigint(20)          | NO   |   该语句消耗时间的增量   |--？不太理解
| CPU_TIME_TOTAL                | bigint(20)          | NO   |           |
| CPU_TIME_DELTA                | bigint(20)          | NO   |         |
| CCWAIT_TOTAL                  | bigint(20)          | NO   |          |
| CCWAIT_DELTA                  | bigint(20)          | NO   |          |
| USERIO_WAIT_TOTAL             | bigint(20)          | NO   |          |
| USERIO_WAIT_DELTA             | bigint(20)          | NO   |         |
| APWAIT_TOTAL                  | bigint(20)          | NO   |           |
| APWAIT_DELTA                  | bigint(20)          | NO   |         |
| PHYSICAL_READ_REQUESTS_TOTAL  | bigint(20)          | NO   |          |
| PHYSICAL_READ_REQUESTS_DELTA  | bigint(20)          | NO   |         |
| PHYSICAL_READ_BYTES_TOTAL     | bigint(20)          | NO   |         |
| PHYSICAL_READ_BYTES_DELTA     | bigint(20)          | NO   |       |
| WRITE_THROTTLE_TOTAL          | bigint(20)          | NO   |       |
| WRITE_THROTTLE_DELTA          | bigint(20)          | NO   |      |
| ROWS_PROCESSED_TOTAL          | bigint(20)          | NO   |       |
| ROWS_PROCESSED_DELTA          | bigint(20)          | NO   |        |
| MEMSTORE_READ_ROWS_TOTAL      | bigint(20)          | NO   |       |
| MEMSTORE_READ_ROWS_DELTA      | bigint(20)          | NO   |       |
| MINOR_SSSTORE_READ_ROWS_TOTAL | bigint(20)          | NO   |      |
| MINOR_SSSTORE_READ_ROWS_DELTA | bigint(20)          | NO   |     |
| MAJOR_SSSTORE_READ_ROWS_TOTAL | bigint(20)          | NO   |        |
| MAJOR_SSSTORE_READ_ROWS_DELTA | bigint(20)          | NO   |      |
| RPC_TOTAL                     | bigint(20)          | NO   |       |
| RPC_DELTA                     | bigint(20)          | NO   |      |
| FETCHES_TOTAL                 | bigint(20)          | NO   |      |
| FETCHES_DELTA                 | bigint(20)          | NO   |        |
| RETRY_TOTAL                   | bigint(20)          | NO   |       |
| RETRY_DELTA                   | bigint(20)          | NO   |         |
| PARTITION_TOTAL               | bigint(20)          | NO   |         |
| PARTITION_DELTA               | bigint(20)          | NO   |       |
| NESTED_SQL_TOTAL              | bigint(20)          | NO   |         |
| NESTED_SQL_DELTA              | bigint(20)          | NO   |       |
| SOURCE_IP                     | varchar(46)         | NO   |        |
| SOURCE_PORT                   | bigint(20)          | NO   |         |

## 查询示例

```sql
obclient [oceanbase]>  SELECT * FROM oceanbase.CDB_WR_SQLSTAT LIMIT 1;
```

查询结果如下：

```shell
+-----------+------------+---------+-----------+----------+----------------------------------+-----------+---------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+--------+---------------+-----------------+-----------------+------------------+------------------+------------------+------------------+-------------------+-------------------+--------------------+--------------------+----------------+----------------+--------------+--------------+-------------------+-------------------+--------------+--------------+------------------------------+------------------------------+---------------------------+---------------------------+----------------------+----------------------+----------------------+----------------------+--------------------------+--------------------------+-------------------------------+-------------------------------+-------------------------------+-------------------------------+-----------+-----------+---------------+---------------+-------------+-------------+-----------------+-----------------+------------------+------------------+
| tenant_id | cluster_id | snap_id | svr_ip    | svr_port | sql_id                           | plan_hash | plan_id | plan_type | query_sql                                                                                                                                                                                                                                                                                                                                                                                                                                     | module | action | parsing_db_id | parsing_db_name | parsing_user_id | executions_total | executions_delta | disk_reads_total | disk_reads_delta | buffer_gets_total | buffer_gets_delta | elapsed_time_total | elapsed_time_delta | cpu_time_total | cpu_time_delta | ccwait_total | ccwait_delta | userio_wait_total | userio_wait_delta | apwait_total | apwait_delta | physical_read_requests_total | physical_read_requests_delta | physical_read_bytes_total | physical_read_bytes_delta | write_throttle_total | write_throttle_delta | rows_processed_total | rows_processed_delta | memstore_read_rows_total | memstore_read_rows_delta | minor_ssstore_read_rows_total | minor_ssstore_read_rows_delta | major_ssstore_read_rows_total | major_ssstore_read_rows_delta | rpc_total | rpc_delta | fetches_total | fetches_delta | retry_total | retry_delta | partition_total | partition_delta | nested_sql_total | nested_sql_delta |
+-----------+------------+---------+-----------+----------+----------------------------------+-----------+---------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+--------+---------------+-----------------+-----------------+------------------+------------------+------------------+------------------+-------------------+-------------------+--------------------+--------------------+----------------+----------------+--------------+--------------+-------------------+-------------------+--------------+--------------+------------------------------+------------------------------+---------------------------+---------------------------+----------------------+----------------------+----------------------+----------------------+--------------------------+--------------------------+-------------------------------+-------------------------------+-------------------------------+-------------------------------+-----------+-----------+---------------+---------------+-------------+-------------+-----------------+-----------------+------------------+------------------+
|      1004 |          1 |       7 | 172.x.x.x |     2881 | 32AB97A0126F566064F84DDDF4936F82 |     39601 |   15537 |         1 | SELECT /*+ NO_REWRITE NO_PARALLEL  DYNAMIC_SAMPLING(0)  QUERY_TIMEOUT(5995578)  OPT_PARAM('USE_DEFAULT_OPT_STAT','TRUE') */ SUM(CASE WHEN  (cast(`table_name` as char(64) charset utf8mb4) = '__wr_sqlstat') and (`tenant_id` = effective_tenant_id()) and (`table_type` in (0,1,2,3,4,14)) THEN 1 ELSE 0 END), SUM(CASE WHEN  (`tenant_id` = effective_tenant_id()) THEN 1 ELSE 0 END) FROM `oceanbase`.`__all_virtual_core_all_table`   `c` |        |        |             1 | oceanbase       |            7353 |            63664 |            54485 |            21310 |            73548 |             20281 |              1599 |              51538 |              50738 |          89653 |          47850 |        91294 |        10981 |             54588 |             84897 |        57093 |        68257 |                        20293 |                         4992 |                     83918 |                     27469 |                34898 |                59707 |                 7582 |                76111 |                    77421 |                    76424 |                         15874 |                         98856 |                         15874 |                         98856      36939 |     72915 |         70765 |         38519 |       50686 |       28129 |           79798 |           24318 |            38513 |            70678 |
+-----------+------------+---------+-----------+----------+----------------------------------+-----------+---------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+--------+---------------+-----------------+-----------------+------------------+------------------+------------------+------------------+-------------------+-------------------+--------------------+--------------------+----------------+----------------+--------------+--------------+-------------------+-------------------+--------------+--------------+------------------------------+------------------------------+---------------------------+---------------------------+----------------------+----------------------+----------------------+----------------------+--------------------------+--------------------------+-------------------------------+-------------------------------+-------------------------------+-------------------------------+-----------+-----------+---------------+---------------+-------------+-------------+-----------------+-----------------+------------------+------------------+
1 row in set
```



## 相关视图或文档