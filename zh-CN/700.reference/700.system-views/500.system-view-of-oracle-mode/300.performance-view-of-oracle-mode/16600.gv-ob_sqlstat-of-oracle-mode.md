|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type| Oracle Mode |

# GV$OB_SQLSTAT

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.2.2 版本开始引入。</p>
</main>

## 功能描述

视图 `GV$OB_SQLSTAT` 用于展示集群中 SQL 的基本性能统计数据，每个 SQL 语句为一行（即每个 `SQL_ID` + `Plan_Hash` 的唯一值为一行）。其中，含 `_DELTA` 的列表示从上次采集 WR 快照到当前时间为止统计值的增量。

## 字段说明

| **字段名称**                  | **类型**            | **是否可以为 NULL** | **描述**                               |
|-------------------------------|---------------------|---------------------|----------------------------------------|
| SVR_IP                        | VARCHAR2(46)    | NO   |    节点 IP |
| SVR_PORT                      | NUMBER          | NO   |    节点端口号     |
| TENANT_ID                     | NUMBER          | NO   |    租户 ID |
| SQL_ID                        | VARCHAR2(32)    | NO   |    SQL 语句 ID   |
| PLAN_ID                       | NUMBER          | NO   |    执行计划 ID   |
| PLAN_HASH                     | NUMBER unsigned | NO   |    执行计划的 Hash 值   |
| PLAN_TYPE                     | NUMBER          | NO   |    对于 SQL 计划的缓存，该字段表示计划的类型：<ul><li>`1`：表示 Local Plan </li> <li>`2`：表示 Remote Plan</li> <li>`3`：表示 Distributed Plan </li></ul> </br>对于 PL 对象缓存，该字段表示 PL 对象的类型：<ul><li>`1`：表示 Procedure</li> <li>`2`：表示 Function</li> <li>`3`：表示 Package</li> <li>`4`：表示 Anonymous Block </li></ul> |
| QUERY_SQL                     | CLOB            | NO   | 全量的 SQL 文本 |
| SQL_TYPE                      | NUMBER          | NO   | 语句类型 |--待补充编号与语句类型的对应关系
| MODULE                        | VARCHAR2(64)    | YES  |   该语句第一次被解析时的应用程序 Module    |
| ACTION                        | VARCHAR2(64)    | YES  |   该语句第一次被解析时的应用程序 Action      |
| PARSING_DB_ID                 | NUMBER          | NO   |   语句解析时的数据库 ID    |
| PARSING_DB_NAME               | VARCHAR2(128)   | NO   |   语句解析时的数据库名称     |
| PARSING_USER_ID               | NUMBER          | NO   |   语句解析时的用户 ID     |
| EXECUTIONS_TOTAL              | NUMBER          | NO   |   计划缓存中该计划的总执行次数     |
| EXECUTIONS_DELTA              | NUMBER          | NO   |   计划缓存中该计划总执行次数的增量      |
| DISK_READS_TOTAL              | NUMBER          | NO   |   磁盘读的总次数 |
| DISK_READS_DELTA              | NUMBER          | NO   |   磁盘读次数的增量 |
| BUFFER_GETS_TOTAL             | NUMBER          | NO   |   从缓存中逻辑读的总次数       |
| BUFFER_GETS_DELTA             | NUMBER          | NO   |   从缓存中逻辑读次数的增量      |
| ELAPSED_TIME_TOTAL            | NUMBER          | NO   |   该语句消耗的总时间。对于并行执行场景，该值为每个执行线程的累加值。          |
| ELAPSED_TIME_DELTA            | NUMBER          | NO   |   该语句消耗时间的增量   |
| CPU_TIME_TOTAL                | NUMBER          | NO   |   总的 CPU 耗时       |
| CPU_TIME_DELTA                | NUMBER          | NO   |   总 CPU 耗时的增量     |
| CCWAIT_TOTAL                  | NUMBER          | NO   |   并发类等待事件的总耗时       |
| CCWAIT_DELTA                  | NUMBER          | NO   |   并发类等待事件总耗时的增量       |
| USERIO_WAIT_TOTAL             | NUMBER          | NO   |   I/O 等待的总耗时      |
| USERIO_WAIT_DELTA             | NUMBER          | NO   |   I/O 等待的总耗时的增量      |
| APWAIT_TOTAL                  | NUMBER          | NO   |   应用类等待事件的总耗时        |
| APWAIT_DELTA                  | NUMBER          | NO   |   应用类等待事件总耗时的增量      |
| PHYSICAL_READ_REQUESTS_TOTAL  | NUMBER          | NO   |   物理读请求的总次数       |
| PHYSICAL_READ_REQUESTS_DELTA  | NUMBER          | NO   |   物理读请求次数的增量      |
| PHYSICAL_READ_BYTES_TOTAL     | NUMBER          | NO   |   物理读的总字节数     |
| PHYSICAL_READ_BYTES_DELTA     | NUMBER          | NO   |   物理读字节数的增量   |
| WRITE_THROTTLE_TOTAL          | NUMBER          | NO   |   写入 MemStore 时被限流的总时间    |
| WRITE_THROTTLE_DELTA          | NUMBER          | NO   |   写入 MemStore 时被限流的总时间的增量    |
| ROWS_PROCESSED_TOTAL          | NUMBER          | NO   |   语句处理的总行数    |
| ROWS_PROCESSED_DELTA          | NUMBER          | NO   |   语句处理的总行数的增量     |
| MEMSTORE_READ_ROWS_TOTAL      | NUMBER          | NO   |   从 MemStore 读取的总行数    |
| MEMSTORE_READ_ROWS_DELTA      | NUMBER          | NO   |   从 MemStore 读取的总行数的增量    |
| MINOR_SSSTORE_READ_ROWS_TOTAL | NUMBER          | NO   |   从 MINOR SSStore 读取的总行数   |
| MINOR_SSSTORE_READ_ROWS_DELTA | NUMBER          | NO   |   从 MINOR SSStore 读取的总行数的增量  |
| MAJOR_SSSTORE_READ_ROWS_TOTAL | NUMBER          | NO   |   从 MAJOR SSStore 读取的总行数     |
| MAJOR_SSSTORE_READ_ROWS_DELTA | NUMBER          | NO   |   从 MAJOR SSStore 读取的总行数的增量   |
| RPC_TOTAL                     | NUMBER          | NO   |   RPC 的总次数    |
| RPC_DELTA                     | NUMBER          | NO   |   RPC 次数的增量   |
| FETCHES_TOTAL                 | NUMBER          | NO   |   获取结果集的总次数   |
| FETCHES_DELTA                 | NUMBER          | NO   |   获取结果集次数的增量     |
| RETRY_TOTAL                   | NUMBER          | NO   |   SQL 重试的总次数   |
| RETRY_DELTA                   | NUMBER          | NO   |   SQL 重试次数的增量      |
| PARTITION_TOTAL               | NUMBER          | NO   |   SQL 执行扫描的分区数的总量      |
| PARTITION_DELTA               | NUMBER          | NO   |   SQL 执行扫描的分区数的增量    |
| NESTED_SQL_TOTAL              | NUMBER          | NO   |   嵌套 SQL 执行的总量，每多执行一次子 SQL 即增加 1     |
| NESTED_SQL_DELTA              | NUMBER          | NO   |   嵌套 SQL 执行的增量    |
| SOURCE_IP                     | CHAR(46)        | NO   |   请求来源的 IP     |
| SOURCE_PORT                   | NUMBER          | NO   |   请求来源的端口号      |

## 查询示例

```sql
obclient [SYS]> SELECT * FROM SYS.GV$OB_SQLSTAT WHERE ROWNUM = 1\G
```

查询结果如下：

```shell
*************************** 1. row ***************************
                       SVR_IP: 172.xx.xxx.xxx
                     SVR_PORT: 2882
                    TENANT_ID: 1004
                       SQL_ID: 17605A1DA6B6A2150E9FBCA5D4C7653A
                      PLAN_ID: 25
                    PLAN_HASH: 12254811659671915614
                    PLAN_TYPE: 1
                    QUERY_SQL: SELECT row_id, column_name, column_value FROM __all_core_table WHERE table_name = ? ORDER BY row_id, column_name
                       MODULE: NULL
                       ACTION: NULL
                PARSING_DB_ID: 201001
              PARSING_DB_NAME: oceanbase
              PARSING_USER_ID: 200001
             EXECUTIONS_TOTAL: 33796
             EXECUTIONS_DELTA: 5072
             DISK_READS_TOTAL: 29
             DISK_READS_DELTA: 14
            BUFFER_GETS_TOTAL: 253909
            BUFFER_GETS_DELTA: 38017
           ELAPSED_TIME_TOTAL: 6049268
           ELAPSED_TIME_DELTA: 994076
               CPU_TIME_TOTAL: 0
               CPU_TIME_DELTA: 0
                 CCWAIT_TOTAL: 0
                 CCWAIT_DELTA: 0
            USERIO_WAIT_TOTAL: 0
            USERIO_WAIT_DELTA: 0
                 APWAIT_TOTAL: 0
                 APWAIT_DELTA: 0
 PHYSICAL_READ_REQUESTS_TOTAL: 29
 PHYSICAL_READ_REQUESTS_DELTA: 14
    PHYSICAL_READ_BYTES_TOTAL: 209769
    PHYSICAL_READ_BYTES_DELTA: 92311
         WRITE_THROTTLE_TOTAL: 0
         WRITE_THROTTLE_DELTA: 0
         ROWS_PROCESSED_TOTAL: 33795
         ROWS_PROCESSED_DELTA: 5072
     MEMSTORE_READ_ROWS_TOTAL: 33754
     MEMSTORE_READ_ROWS_DELTA: 5040
MINOR_SSSTORE_READ_ROWS_TOTAL: 62907
MINOR_SSSTORE_READ_ROWS_DELTA: 8559
MAJOR_SSSTORE_READ_ROWS_TOTAL: 15638
MAJOR_SSSTORE_READ_ROWS_DELTA: 5072
                    RPC_TOTAL: 2
                    RPC_DELTA: 0
                FETCHES_TOTAL: 0
                FETCHES_DELTA: 0
                  RETRY_TOTAL: 0
                  RETRY_DELTA: 0
              PARTITION_TOTAL: 33796
              PARTITION_DELTA: 5072
             NESTED_SQL_TOTAL: 0
             NESTED_SQL_DELTA: 0
                    SOURCE_IP: 172.xx.xxx.xxx
                  SOURCE_PORT: 2882
1 row in set
```

## 相关视图或文档

* [V$OB_SQLSTAT](16700.v-ob_sqlstat-of-oracle-mode.md)

* [DBA_WR_SQLSTAT](../200.dictionary-view-of-oracle-mode/33000.dba_wr_sqlstat-of-oracle-mode.md)
