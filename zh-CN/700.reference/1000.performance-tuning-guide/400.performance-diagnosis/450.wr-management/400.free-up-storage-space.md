# 释放存储空间

通过使用 SQL 语句检查 WR 存储占用情况，如果 WR 占用存储太多可以使用 DBMS 包对数据进行删除。

## 查看 SSTable 中 WR 占用的空间

通过 `__all_virtual_table`、`__all_virtual_tablet_meta_table` 和 `__all_virtual_ls_meta_table` 表查看 SSTable 中 WR 占用的空间：

```sql
select sum(b.data_size) from __all_virtual_table a inner join __all_virtual_tablet_meta_table b on a.tenant_id=b.tenant_id and a.tablet_id=b.tablet_id left join __all_virtual_ls_meta_table c on b.tenant_id=c.tenant_id and b.ls_id = c.ls_id and b.svr_ip=c.svr_ip and b.svr_port = c.svr_port where a.table_name like "__wr_%" and a.tablet_id != 0;
```

返回结果如下：

```sql
+------------------+
| sum(b.data_size) |
+------------------+
|           316753 |
+------------------+
1 row in set (0.024 sec)
```

其中 data_size 表示表中存储的数据的总大小，单位为字节。

## 查看 MemTable 中 WR 占用的空间

通过 `__all_virtual_table`、`__all_virtual_memstore_info` 和 `__all_virtual_ls_meta_table` 表查看 SSTable 中 WR 占用的空间：

```sql
select sum(mem_used), sum(hash_mem_used), sum(btree_mem_used) from __all_virtual_table a inner join __all_virtual_memstore_info b on a.tenant_id=b.tenant_id and a.tablet_id=b.tablet_id left join __all_virtual_ls_meta_table c on b.tenant_id=c.tenant_id and b.ls_id = c.ls_id and b.svr_ip=c.svr_ip and b.svr_port = c.svr_port where a.table_name like "__wr%" and a.tablet_id != 0;
```

返回结果如下：

```sql
+---------------+--------------------+---------------------+
| sum(mem_used) | sum(hash_mem_used) | sum(btree_mem_used) |
+---------------+--------------------+---------------------+
|      39845888 |            3729280 |                 320 |
+---------------+--------------------+---------------------+
1 row in set (0.047 sec)
```

参数说明：

| 字段 | 描述 |
|------|-----|
| mem_used | 表在内存中使用的总内存量，单位为字节 |
| hash_mem_used | 哈希表在内存中使用的总内存量，单位为字节|
| btree_mem_used | 树索引在内存中使用的总内存量，单位为字节 |

## 清理 WR 占用的空间

如果 WR 占用存储太多可以使用 DBMS 包进行清理：

```sql
obclient [(none)]> CALL DBMS_WORKLOAD_REPOSITORY.DROP_SNAPSHOT_RANGE('123','456');
Query OK, 0 rows affected (1.018 sec)
```
