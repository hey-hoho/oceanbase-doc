|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 附：主切备失败的错误信息及处理方法

在执行 `SWITCHOVER TO STANDBY VERIFY` 命令验证主租户是否可以切换为备租户，或者执行 `SWITCHOVER TO STANDBY VERIFY` 命令进行主切备操作时，系统可能会提示报错信息，该报错信息展示了不能成功执行切换命令的原因，本节主要列举可能出现的报错信息所表示的含义以及针对该报错的处理方法。

## 报错信息 1：tenant status is not normal, switchover to standby is not allowed

### 含义

当前租户的状态不是 `NORMAL`，只有 `NORMAL` 状态的租户才能执行角色切换命令。

### 处理方法

1. 执行以下 SQL，查询当前租户的状态。

    :::tab
    tab 系统租户

    系统租户下，通过以下 SQL 查看指定租户的状态。

    ```sql
    SELECT TENANT_NAME, STATUS FROM oceanbase.DBA_OB_TENANTS WHERE TENANT_NAME = 'tenant_name';
    ```

    tab 用户租户

    MySQL 模式下，通过以下 SQL 查看当前租户的状态。

    ```sql
    SELECT TENANT_NAME, STATUS FROM oceanbase.DBA_OB_TENANTS;
    ```

    Oracle 模式下，通过以下 SQL 查看当前租户的状态。

    ```sql
    SELECT TENANT_NAME, STATUS FROM SYS.DBA_OB_TENANTS;
    ```

    :::

2. 根据查询结果，排查租户状态不是 `NORMAL` 的原因，租户可能还在创建中或恢复中，可以等待租户创建完成，或联系技术支持人员协助处理。

## 报错信息 2：switchover status not match, switchover to standby is not allowed

### 含义

租户处于当前的 `SWITCHOVER_STATUS` 状态时，不能执行指定的角色切换命令。

### 处理方法

1. 执行以下 SQL，查询当前租户 `SWITCHOVER_STATUS` 的状态。

    :::tab
    tab 系统租户

    系统租户下，通过以下 SQL 查看指定租户的 `SWITCHOVER_STATUS` 的状态。

    ```sql
    SELECT TENANT_NAME, TENANT_ROLE, SWITCHOVER_STATUS FROM oceanbase.DBA_OB_TENANTS WHERE TENANT_NAME = 'tenant_name';
    ```

    tab 用户租户

    MySQL 模式下，通过以下 SQL 查看当前租户 `SWITCHOVER_STATUS` 的状态。

    ```sql
    SELECT TENANT_NAME, TENANT_ROLE, SWITCHOVER_STATUS FROM oceanbase.DBA_OB_TENANTS;
    ```

    Oracle 模式下，通过以下 SQL 查看当前租户 `SWITCHOVER_STATUS` 的状态。

    ```sql
    SELECT TENANT_NAME, TENANT_ROLE, SWITCHOVER_STATUS FROM SYS.DBA_OB_TENANTS;
    ```

    :::

2. 根据查询结果，排查租户的 `SWITCHOVER_STATUS` 处于此状态的原因，并联系技术支持人员协助处理。

## 报错信息 3：Incorrect arguments to tenant name, only support operating user tenant

### 含义

租户类型不是 `USER`，只能对用户租户执行角色切换命令。

### 处理方法

1. 执行以下 SQL，查询当前租户的租户类型。

    :::tab
    tab 系统租户

    系统租户下，通过以下 SQL 查看指定租户的租户类型。

    ```sql
    SELECT TENANT_NAME, TENANT_TYPE FROM oceanbase.DBA_OB_TENANTS WHERE TENANT_NAME = 'tenant_name';
    ```

    tab 用户租户

    MySQL 模式下，通过以下 SQL 查看当前租户的租户类型。

    ```sql
    SELECT TENANT_NAME, TENANT_TYPE FROM oceanbase.DBA_OB_TENANTS;
    ```

    Oracle 模式下，通过以下 SQL 查看当前租户的租户类型。

    ```sql
    SELECT TENANT_NAME, TENANT_TYPE FROM SYS.DBA_OB_TENANTS;
    ```

    :::

2. 根据查询结果，检查命令中指定的租户名是否正确，并重新执行角色切换命令。

## 报错信息 4：Incorrect arguments to tenant name, please don't specify tenant name

### 含义

登录用户租户执行命令时，不能指定租户名，只能默认为该用户租户。

### 处理方法

去掉命令中的 `TENANT tenant_name`，并重新执行切换命令。

