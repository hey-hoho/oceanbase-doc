# 通过调整 Primary Zone 实现租户扩缩容

本文介绍如何通过修改 Primary Zone，达到租户扩容的功能。

## 前提条件

调整 Primary Zone 前，需要设置租户内的负载均衡策略。租户内的负载均衡策略由租户级配置项 `enable_rebalance` 和 `enable_transfer` 共同控制。

配置项 `enable_rebalance` 在系统租户下用于控制是否进行租户间的负载均衡；在用户租户下用于控制是否进行租户内均衡。默认值为 `true`，设置后不需要重启 OBServer 节点，立即生效。

配置项 `enable_transfer` 用于控制是否开启租户下的 Transfer 功能，默认值为 `true`，设置后不需要重启 OBServer 节点，立即生效。配置项 `enable_transfer` 值的含义依赖配置项 `enable_rebalance` 的取值：
  
* 当配置项 `enable_rebalance` 的值为 `false` 时，配置项 `enable_transfer` 的值无效。

* 当配置项 `enable_rebalance` 的值为 `true` 且 `enable_transfer` 的值为 为 `true` 时，表示在进行租户扩缩容时，系统会自动调整租户内日志流的数量，通过日志流分裂、合并以及 Transfer 等操作，进行租户下的 Leader 均衡和分区均衡。

* 当配置项 `enable_rebalance` 的值为 `true` 且 `enable_transfer` 的值为 为 `flase` 时，表示在进行租户扩缩容时，系统不会进行 Transfer 并且不会出现日志流数量的变化，仅在现有日志流的基础上尽量保证日志流均衡。

具体设置方法如下：

* 系统租户设置指定租户的负载均衡策略

  * 系统租户开启指定租户的租户内负载均衡和租户下的 Transfer 功能

    ```sql
    ALTER SYSTEM SET enable_rebalance = true TENANT = 'tenant_name';
    ```

    ```sql
    ALTER SYSTEM SET enable_transfer = true TENANT = 'tenant_name';
    ```

    以上语句表示仅指定租户下的配置项 `enable_rebalance` 和 `enable_transfer` 的值为 `true`。

  * 系统租户开启所有用户租户（不含 `sys` 租户和 Meta 租户）的租户内负载均衡和租户下的 Transfer 功能

    ```sql
    ALTER SYSTEM SET enable_rebalance = true TENANT = all_user;
    ```

    ```sql
    ALTER SYSTEM SET enable_transfer = true TENANT = all_user;
    ```

    或者

    ```sql
    ALTER SYSTEM SET enable_rebalance = true TENANT = all;
    ```

    ```sql
    ALTER SYSTEM SET enable_transfer = true TENANT = all;
    ```

    以上语句表示所有用户租户下配置项 `enable_rebalance` 和 `enable_transfer` 的值为 `true`。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>OceanBase 数据库从 V4.2.1 版本开始，<code>TENANT = all_user</code> 与 <code>TENANT = all</code>语义相同，在需要生效范围为所有用户租户时，推荐使用 <code>TENANT = all_user</code>，后续 <code>TENANT = all</code> 将废弃不再使用。</p>
    </main>

* 用户租户设置本租户的负载均衡策略

  用户租户开启本租户的租户内负载均衡和租户下的 Transfer 功能的语句如下：

  ```sql
  ALTER SYSTEM SET enable_rebalance = true;
  ```

  ```sql
  ALTER SYSTEM SET enable_transfer = true;
  ```

更多配置项 `enable_rebalance` 和 `enable_transfer` 的详细说明，请参见 [enable_rebalance](../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/6700.enable_rebalance.md) 和 [enable_transfer](../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/25600.enable_transfer.md)。

## 增加 Primary Zone

1. 使用 `root` 用户登录到集群的 `sys` 租户。

    ```shell
    obclient -h172.30.xxx.xxx -P2883 -uroot@sys -pxxxx -A
    ```

2. 进入 `oceanbase` 数据库。

    ```sql
    use oceanbase;
    ```

3. 查询租户 `mq_t1` 的基本信息，例如 `locality`、`primary zone` 等属性。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANTS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   | TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE      | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS | UNIT_NUM | COMPATIBLE |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   |      1004 | mq_t1       | USER        | 2023-07-01 19:16:39.739258 | 2023-07-03 14:39:47.409845 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1688366766761651752 | 1688366766761651752 | 1688366766761651751 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |        2 | 4.2.0.0    |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   1 row in set
   ```

4. 查询租户 `mq_t1` 的 Unit 信息，在单个 Zone 的 `unit num` 为 2。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_UNITS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   | UNIT_ID | TENANT_ID | STATUS | RESOURCE_POOL_ID | UNIT_GROUP_ID | CREATE_TIME                | MODIFY_TIME                | ZONE  | SVR_IP         | SVR_PORT | MIGRATE_FROM_SVR_IP | MIGRATE_FROM_SVR_PORT | MANUAL_MIGRATE | UNIT_CONFIG_ID | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   |    1008 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.723840 | 2023-07-01 19:16:39.744524 | zone1 | xx.xx.xx.198   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1010 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.727011 | 2023-07-01 19:16:39.744524 | zone2 | xx.xx.xx.197   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1012 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.731235 | 2023-07-01 19:16:39.745584 | zone3 | xx.xx.xx.192   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1016 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.298237 | 2023-07-03 14:23:00.298237 | zone1 | xx.xx.xx.196   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1017 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.300350 | 2023-07-03 14:23:00.300350 | zone2 | xx.xx.xx.194   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1018 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.302460 | 2023-07-03 14:23:00.302460 | zone3 | xx.xx.xx.64    |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   6 rows in set
   ```

5. 修改租户 `mq_t1` 的 `PRIMARY_ZONE` 属性，从 1 调整为 2 。

   ```sql
   ALTER TENANT mq_t1 PRIMARY_ZONE='zone1,zone2;zone3'; 
   ```

6. 确认增加 Primary Zone 任务的执行结果。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANT_JOBS WHERE JOB_TYPE='ALTER_TENANT_PRIMARY_ZONE';
   ```

   根据查询结果，如果 `JOB_STATUS` 的值为 `SUCCESS`，则表示扩容成功。

   有关视图 `DBA_OB_TENANT_JOBS` 的详细字段说明，请参见 [DBA_OB_TENANT_JOBS](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/5700.oceanbase-dba_ob_tenant_jobs-of-sys-tenant.md)。

7. 查询租户 `mq_t1` 的基本信息，确认 `PRIMARY_ZONE` 属性修改成功，第一优先级由 `zone1` 变更为 `zone1,zone2`。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANTS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   | TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE      | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS | UNIT_NUM | COMPATIBLE |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   |      1004 |  mq_t1      | USER        | 2023-07-01 19:16:39.739258 | 2023-07-03 14:52:38.639769 | zone1,zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1688367181014913489 | 1688367181014913489 | 1688367181014913488 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |        2 | 4.2.0.0    |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   1 row in set
   ```

8. 查询租户 `mq_t1` 的 Unit 信息，变更前后 `unit num` 保持不变。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_UNITS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   | UNIT_ID | TENANT_ID | STATUS | RESOURCE_POOL_ID | UNIT_GROUP_ID | CREATE_TIME                | MODIFY_TIME                | ZONE  | SVR_IP         | SVR_PORT | MIGRATE_FROM_SVR_IP | MIGRATE_FROM_SVR_PORT | MANUAL_MIGRATE | UNIT_CONFIG_ID | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   |    1008 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.723840 | 2023-07-01 19:16:39.744524 | zone1 | xx.xx.xx.198   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1010 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.727011 | 2023-07-01 19:16:39.744524 | zone2 | xx.xx.xx.197   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1012 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.731235 | 2023-07-01 19:16:39.745584 | zone3 | xx.xx.xx.192   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1016 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.298237 | 2023-07-03 14:23:00.298237 | zone1 | xx.xx.xx.196   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1017 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.300350 | 2023-07-03 14:23:00.300350 | zone2 | xx.xx.xx.194   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1018 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.302460 | 2023-07-03 14:23:00.302460 | zone3 | xx.xx.xx.64    |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   6 rows in set
   ```

通过上述示例，将租户 `mq_t1` 的 Primary Zone 的 Zone 个数从 1 变更为 2。变更前租户在每个 Zone 的 Unit 个数为 2；变更后租户在每个 Zone 的 Unit 个数保持不变，但 Primary Zone 个数从 1 变更为 2，从而实现了租户扩容。

## 减少 Primary Zone

1. 使用 `root` 用户登录到集群的 `sys` 租户。

    ```shell
    obclient -h172.30.xxx.xxx -P2883 -uroot@sys -pxxxx -A
    ```

2. 进入 `oceanbase` 数据库。

    ```sql
    use oceanbase;
    ```

3. 查询租户 `mq_t1` 的基本信息，例如 `locality`、`primary zone` 等属性。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANTS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   | TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE      | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS | UNIT_NUM | COMPATIBLE |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   |      1004 | mq_t1       | USER        | 2023-07-01 19:16:39.739258 | 2023-07-03 14:34:26.944961 | zone1,zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1688366177567368939 | 1688366177567368939 | 1688366177432837207 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |        2 | 4.2.0.0    |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   1 row in set
   ```

4. 查询租户 `mq_t1` 的 Unit 信息，在单个 Zone 的 `unit num` 为 2。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_UNITS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   | UNIT_ID | TENANT_ID | STATUS | RESOURCE_POOL_ID | UNIT_GROUP_ID | CREATE_TIME                | MODIFY_TIME                | ZONE  | SVR_IP         | SVR_PORT | MIGRATE_FROM_SVR_IP | MIGRATE_FROM_SVR_PORT | MANUAL_MIGRATE | UNIT_CONFIG_ID | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   |    1008 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.723840 | 2023-07-01 19:16:39.744524 | zone1 | xx.xx.xx.198   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1010 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.727011 | 2023-07-01 19:16:39.744524 | zone2 | xx.xx.xx.197   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1012 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.731235 | 2023-07-01 19:16:39.745584 | zone3 | xx.xx.xx.192   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1016 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.298237 | 2023-07-03 14:23:00.298237 | zone1 | xx.xx.xx.196   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1017 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.300350 | 2023-07-03 14:23:00.300350 | zone2 | xx.xx.xx.194   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1018 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.302460 | 2023-07-03 14:23:00.302460 | zone3 | xx.xx.xx.64    |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   6 rows in set
   ```

5. 修改租户 `mq_t1` 的 `PRIMARY_ZONE` 属性，第一优先级 Zone 的个数从 2 调整为 1。

   ```sql
   ALTER TENANT mq_t1 PRIMARY_ZONE='zone1;zone2,zone3'; 
   ```

6. 确认减少 Primary Zone 任务的执行结果。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANT_JOBS WHERE JOB_TYPE='ALTER_TENANT_PRIMARY_ZONE';
   ```

   根据查询结果，如果 `JOB_STATUS` 的值为 `SUCCESS`，则表示缩容成功。

   有关视图 `DBA_OB_TENANT_JOBS` 的详细字段说明，请参见 [DBA_OB_TENANT_JOBS](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/5700.oceanbase-dba_ob_tenant_jobs-of-sys-tenant.md)。

7. 查询租户 `mq_t1` 的基本信息，确认 `PRIMARY_ZONE` 属性修改成功，由 `zone1,zone2` 变更为 `zone1`。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_TENANTS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   | TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE      | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED | TENANT_ROLE | SWITCHOVER_STATUS | SWITCHOVER_EPOCH | SYNC_SCN            | REPLAYABLE_SCN      | READABLE_SCN        | RECOVERY_UNTIL_SCN  | LOG_MODE     | ARBITRATION_SERVICE_STATUS | UNIT_NUM | COMPATIBLE |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   |      1004 | mq_t1       | USER        | 2023-07-01 19:16:39.739258 | 2023-07-03 15:02:28.600516 | zone1;zone2,zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     | PRIMARY     | NORMAL            |                0 | 1688367783544758489 | 1688367783544758489 | 1688367783544758488 | 4611686018427387903 | NOARCHIVELOG | DISABLED                   |        2 | 4.2.0.0    |
   +-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+-------------+-------------------+------------------+---------------------+---------------------+---------------------+---------------------+--------------+----------------------------+----------+------------+
   1 row in set
   ```

8. 再次查询租户 `mq_t1` 的 Unit 信息，变更前后 `unit num` 保持不变。

   ```sql
   SELECT * FROM oceanbase.DBA_OB_UNITS WHERE tenant_id = 1004;
   ```

   查询结果如下：

   ```shell
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   | UNIT_ID | TENANT_ID | STATUS | RESOURCE_POOL_ID | UNIT_GROUP_ID | CREATE_TIME                | MODIFY_TIME                | ZONE  | SVR_IP         | SVR_PORT | MIGRATE_FROM_SVR_IP | MIGRATE_FROM_SVR_PORT | MANUAL_MIGRATE | UNIT_CONFIG_ID | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   |    1008 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.723840 | 2023-07-01 19:16:39.744524 | zone1 | xx.xx.xx.198   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1010 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.727011 | 2023-07-01 19:16:39.744524 | zone2 | xx.xx.xx.197   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1012 |      1004 | ACTIVE |             1002 |          1002 | 2023-07-01 19:15:09.731235 | 2023-07-01 19:16:39.745584 | zone3 | xx.xx.xx.192   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1016 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.298237 | 2023-07-03 14:23:00.298237 | zone1 | xx.xx.xx.196   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1017 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.300350 | 2023-07-03 14:23:00.300350 | zone2 | xx.xx.xx.194   |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   |    1018 |      1004 | ACTIVE |             1002 |          1006 | 2023-07-03 14:23:00.302460 | 2023-07-03 14:23:00.302460 | zone3 | xx.xx.xx.64    |     2882 | NULL                |                  NULL | NULL           |           1001 |       2 |       2 |  5368709120 |   16106127360 |    20000 |    20000 |           2 |
   +---------+-----------+--------+------------------+---------------+----------------------------+----------------------------+-------+----------------+----------+---------------------+-----------------------+----------------+----------------+---------+---------+-------------+---------------+----------+----------+-------------+
   6 rows in set
   ```

通过上述示例，将租户 `mq_t1` 的 Primary Zone 的 Zone 个数从 2 变更为 1。变更前租户在每个 Zone 的 Unit 个数为 2；变更后租户在每个 Zone 的 Unit 个数保持不变，但 Primary Zone 个数从 2 变更为 1，从而实现了租户缩容。
