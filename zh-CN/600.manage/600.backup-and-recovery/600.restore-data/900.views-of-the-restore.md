# 物理恢复相关视图介绍

OceanBase 数据库支持通过各视图查看恢复的进度与结果。

## CDB_OB_RESTORE_PROGRESS

`CDB_OB_RESTORE_PROGRESS` 用于展示各租户恢复的进度。

|  字段 |  描述 |
|----------------------------------|------------------------|
| TENANT_ID                        | 执行恢复任务的租户 ID  |
| JOB_ID                           | 恢复所属的 job_id, 对应一次恢复任务  |
| RESTORE_TENANT_NAME              | 待恢复的租户名  |
| RESTORE_TENANT_ID                | 待恢复的恢复租户 ID  |
| BACKUP_TENANT_NAME               | 备份的源租户名  |
| BACKUP_TENANT_ID                 | 备份的源租户 ID  |
| BACKUP_CLUSTER_NAME              | 备份的源集群名  |
| BACKUP_DEST                      |备份集路径，指用户输入的数据备份路径与日志归档路径    |
| RESTORE_OPTION                   | 恢复选项，发起恢复时，用户指定的 `restore_option`  |
| RESTORE_SCN                      | 用户指定的恢复位点  |
| RESTORE_SCN_DISPLAY              | 用户指定的恢复位点的时间戳表示  |
| STATUS                           | 恢复状态: 系统租户的恢复任务与被恢复租户的恢复任务状态不一致。<br>系统租户: <ul><li> `CREATE_TENANT` : 创建租户，此阶段系统租户创建被恢复租户 </li> <li> `WAIT_TENANT_RESTORE_FINISH` : 等待被恢复租户恢复结束 </li> <li> `RESTORE_SUCCESS` : 恢复租户成功 </li> <li> `RESTORE_FAIL` : 恢复租户失败 </li></ul> <br>被恢复租户: <ul><li>`RESTORING`：租户数据恢复中 </li> <li> `POST_CHECK` : 检查租户角色，恢复成备库 </li> <li> `UPGRADE` : 升级，如果是跨版本恢复，租户会执行升级流程 </li> <li> `RESTORE_SUCCESS` : 恢复成功 </li> <li> `RESTORE_FAIL` : 恢复失败 </li></ul> |
| START_TIMESTAMP                  | 恢复任务开始时间戳  |
| BACKUP_SET_LIST                  | 恢复依赖的数据备份集路径列表, 备份集间以 `,` 分隔，例如: `file:///data/nfs/backup/data/backup_set_1_full,file:///data/nfs/backup/data/backup_set_2_inc` |
| BACKUP_PIECE_LIST                | 恢复依赖的日志归档分片路径列表, 分片间以 `,` 分隔, 例如: `file:///data/nfs/backup/archive/2_1_2,file:///data/nfs/backup/archive/2_1_3`  |
| TOTAL_BYTES                      | 恢复总字节数  |
| TOTAL_BYTES_DISPLAY              | 恢复总字节数，以存储容量单位显示  |
| FINISH_BYTES                     | 完成恢复字节数  |
| FINISH_BYTES_DISPLAY             | 完成恢复字节数，以存储容量单位显示  |
| DESCRIPTION                      | 恢复命令里指定的 `DESCRIPTION` 信息   |

## CDB_OB_RESTORE_HISTORY

`CDB_OB_RESTORE_HISTORY` 用于展示各租户的恢复结果。

|  字段 |  描述 |
|----------------------------------|--------------|
| TENANT_ID                        | 执行恢复任务的租户 ID  |
| JOB_ID                           | 恢复所属 job_id, 对应一次恢复任务 |
| RESTORE_TENANT_NAME              | 恢复的租户名  |
| RESTORE_TENANT_ID                | 恢复的租户 ID  |
| BACKUP_TENANT_NAME               | 备份的源租户名    |
| BACKUP_TENANT_ID                 | 备份的源租户 ID  |
| BACKUP_CLUSTER_NAME              | 备份的源集群名   |
| BACKUP_DEST                      | 备份集路径，指用户输入的数据备份路径与日志归档路径   |
| RESTORE_SCN                      | bigint(20) unsigned | 用户指定的恢复位点  |
| RESTORE_SCN_DISPLAY              | 用户指定的恢复位点的时间戳表示  |
| RESTORE_OPTION                   | 恢复选项，发起恢复时，用户指定的 `restore_option`  |
| START_TIMESTAMP                  | 恢复任务开始时间戳  |
| FINISH_TIMESTAMP                 | 恢复任务结束时间戳  |
| STATUS                           | 恢复结果: <ul> <li> `SUCCESS` : 表示恢复成功 </li> <li> `FAILED` : 表示恢复失败 </li></ul> |
| BACKUP_PIECE_LIST                | 恢复依赖的日志归档分片路径列表, 分片间以 `,` 分隔, 例如: `file:///data/nfs/backup/archive/2_1_2,file:///data/nfs/backup/archive/2_1_3` |
| BACKUP_SET_LIST                  | 恢复依赖的数据备份集路径列表, 备份集间以 `,` 分隔，例如: `file:///data/nfs/backup/data/backup_set_1_full,file:///data/nfs/backup/data/backup_set_2_inc` |
| BACKUP_CLUSTER_VERSION           | 备份源集群版本号 |
| LS_COUNT                         | 恢复日志流总量   |
| FINISH_LS_COUNT                  | 完成恢复日志流数量  |
| TABLET_COUNT                     | 恢复分片总量  |
| FINISH_TABLET_COUNT              | 完成恢复分片数量  |
| TOTAL_BYTES                      | 恢复总字节数  |
| TOTAL_BYTES_DISPLAY              | 恢复总字节数，以存储容量单位显示  |
| FINISH_BYTES                     | 完成恢复字节数  |
| FINISH_BYTES_DISPLAY             | 完成恢复字节数，以存储容量单位显示  |
| DESCRIPTION                      | 恢复命令里指定的 `DESCRIPTION` 信息  |
| COMMENT                          | 恢复失败时记录失败信息  |

## CDB_OB_RECVOER_TABLE_JOBS

`CDB_OB_RECOVER_TABLE_JOB` 用于展示表级恢复任务的任务记录。--tips：未查到该视图

|  字段                  |  描述                                          |
|-----------------------|------------------------------------------------|
| TENANT_ID             | 当前执行恢复任务的租户的 ID                      |
| JOB_ID                | 任务的 JOB_ID                                   |
| INITIATOR_TENANT_ID   | 用于标识源租户的租户 ID                           |
| INITIATOR_JOB_ID      | 用于标识父任务的 JOB_ID                          |
| START_TIMESTAMP       | 任务的开始时间，单位为纳秒                        |
| FINISH_TIMESTAMP      | 任务的完成时间，单位为纳秒                        |
| STATUS                | 恢复任务的状态：tips：需要补充有哪些状态           |
| AUX_TENANT_NAME       | 辅助租户名                                      |
| TARGET_TENANT_NAME    | 目标租户的租户 ID                               |
| IMPORT_ALL            | tips？需要补充信息                              |
| DB_LIST               | 需要完全恢复的数据库                             |
| TABLE_LIST            | 需要恢复的表                                    |
| RESTORE_SCN           | 需要恢复的分区                                  |
| RESTORE_SCN_DISPLAY   |  ？   |
| RESTORE_OPTION        | 辅助租户依赖的 `restore_option` 参数信息         |
| BACKUP_DEST           | 备份路径和归档路径                               |
| BACKUP_SET_LIST       | 数据备份路径                                     |
| BACKUP_PIECE_LIST     | 日志归档路径                                     |
| BACKUP_PASSWD         | 备份集密码                                       |
| EXTERNAL_KMS_INFO     | 如果源租户设置了秘钥托管，则会在 Session 中设置该信息       |
| REMAP_DB_LIST         | 待重命名的数据库，格式如下：`db1:new_db1,db2:newdb2`，其中，`db1` 和 `db2` 为原数据库名     |
| REMAP_TABLE_LIST      | 待重命名的表，格式如下：`db1.t1:new_t1, db1.t2:db2.new_t2` 其中，`t1` 和 `t2` 为原表名        |
| REMAP_TABLEGROUP_LIST | 待重命名的表组，格式如下：`tg1:new_tg1, tg2:new_tg2` 其中，`tg1` 和 `tg2` 为原表组名    |
| REMAP_TABLESPACE_LIST | 待重命名的表空间，格式如下：`ts1:new_ts1, ts2:new_ts2` 其中，`ts1` 和 `ts2` 为原表组名    |
| RESULT                | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT               | 任务执行失败后，任务相关的报错信息                |
| DESCRIPTION           | 任务相关的描述                                  |
  

## CDB_OB_RECOVER_TABLE_JOB_HISTORY

`CDB_OB_RECOVER_TABLE_JOB_HISTORY` 用于展示表级恢复任务的历史记录。

|  字段                  |  描述                                          |
|-----------------------|------------------------------------------------|
| TENANT_ID             | 执行当前任务的租户的 ID                      |
| JOB_ID                | 当前任务的 JOB_ID                                   |
| INITIATOR_TENANT_ID   | 用于标识执行父任务的租户 ID                       |
| INITIATOR_JOB_ID      | 用于标识父任务的 JOB_ID                          |
| START_TIMESTAMP       | 任务的开始时间，单位为纳秒                        |
| FINISH_TIMESTAMP      | 任务的完成时间，单位为纳秒                        |
| STATUS                | 恢复任务的状态：tips：需要补充有哪些状态           |
| AUX_TENANT_NAME       | 辅助租户名                                      |
| TARGET_TENANT_NAME    | 目标租户的租户 ID                               |
| IMPORT_ALL            | tips？需要补充信息                              |
| DB_LIST               | 需要完全恢复的数据库                             |
| TABLE_LIST            | 需要恢复的表                                    |
| RESTORE_SCN           | 需要恢复的分区                                  |
| RESTORE_SCN_DISPLAY   |  ？   |
| RESTORE_OPTION        | 辅助租户依赖的 `restore_option` 参数信息         |
| BACKUP_DEST           | 备份路径和归档路径                               |
| BACKUP_SET_LIST       | 数据备份路径                                     |
| BACKUP_PIECE_LIST     | 日志归档路径                                     |
| BACKUP_PASSWD         | 备份集密码                                       |
| EXTERNAL_KMS_INFO     | 如果源租户设置了秘钥托管，则会在 Session 中设置该信息       |
| REMAP_DB_LIST         | 待重命名的数据库，格式如下：`db1:new_db1,db2:newdb2`，其中，`db1` 和 `db2` 为原数据库名     |
| REMAP_TABLE_LIST      | 待重命名的表，格式如下：`db1.t1:new_t1, db1.t2:db2.new_t2` 其中，`t1` 和 `t2` 为原表名        |
| REMAP_TABLEGROUP_LIST | 待重命名的表组，格式如下：`tg1:new_tg1, tg2:new_tg2` 其中，`tg1` 和 `tg2` 为原表组名    |
| REMAP_TABLESPACE_LIST | 待重命名的表空间，格式如下：`ts1:new_ts1, ts2:new_ts2` 其中，`ts1` 和 `ts2` 为原表组名    |
| RESULT                | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT               | 任务执行失败后，任务相关的报错信息                |
| DESCRIPTION           | 任务相关的描述                                  |

## CDB_OB_IMPORT_TABLE_JOBS

`CDB_OB_IMPORT_TABLE_JOBS` 展示扩租户导入任务的记录。

|  字段                  |  描述                                  |
|-----------------------|----------------------------------------|
| TENANT_ID             | 执行当前任务的租户的 ID                 |
| JOB_ID                | 当前任务的 JOB_ID                          |
| INITIATOR_TENANT_ID   | 用于标识执行父任务的租户 ID   |
| INITIATOR_JOB_ID      | 用于标识父任务的 JOB_ID      |
| START_TIMESTAMP       | 任务的开始时间，单位为纳秒      |
| FINISH_TIMESTAMP      | 任务的完成时间，单位为纳秒     |
| SRC_TENANT_NAME       | 源租户的租户名     |
| SRC_TENANT_ID         | 源租户的租户 ID       |
| STATUS                | 任务的状态：？      |
| IMPORT_ALL            |  ？     |
| DB_LIST               | 需要完全导入的数据库                      |
| TABLE_LIST            | 需要导入的表                             |
| REMAP_DB_LIST         | 待重命名的数据库，格式如下：`db1:new_db1,db2:newdb2`，其中，`db1` 和 `db2` 为原数据库名     |
| REMAP_TABLE_LIST      | 待重命名的表，格式如下：`db1.t1:new_t1, db1.t2:db2.new_t2` 其中，`t1` 和 `t2` 为原表名        |
| REMAP_TABLEGROUP_LIST | 待重命名的表组，格式如下：`tg1:new_tg1, tg2:new_tg2` 其中，`tg1` 和 `tg2` 为原表组名    |
| REMAP_TABLESPACE_LIST | 待重命名的表空间，格式如下：`ts1:new_ts1, ts2:new_ts2` 其中，`ts1` 和 `ts2` 为原表组名    |
| TOTAL_TABLE_COUNT     | 需要导入的表的总数      |
| FINISHED_TABLE_COUNT  | 已经导入的表的数量     |
| FAILED_TABLE_COUNT    | 导入失败的表的数量       |
| RESULT                | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT               | 任务执行失败后，任务相关的报错信息                |
| DESCRIPTION           | 任务相关的描述                                  |

## CDB_OB_IMPORT_TABLE_JOB_HISTORY

`CDB_OB_IMPORT_TABLE_JOB_HISTORY` 展示扩租户导入任务的历史记录。

|  字段                  |  描述                                  |
|-----------------------|----------------------------------------|
| TENANT_ID             | 执行当前任务的租户的 ID                 |
| JOB_ID                | 当前任务的 JOB_ID                          |
| INITIATOR_TENANT_ID   | 用于标识执行父任务的租户 ID   |
| INITIATOR_JOB_ID      | 用于标识父任务的 JOB_ID      |
| START_TIMESTAMP       | 任务的开始时间，单位为纳秒      |
| FINISH_TIMESTAMP      | 任务的完成时间，单位为纳秒     |
| SRC_TENANT_NAME       | 源租户的租户名     |
| SRC_TENANT_ID         | 源租户的租户 ID       |
| STATUS                | 任务的状态：？      |
| IMPORT_ALL            |  ？     |
| DB_LIST               | 需要完全导入的数据库                      |
| TABLE_LIST            | 需要导入的表                             |
| REMAP_DB_LIST         | 待重命名的数据库，格式如下：`db1:new_db1,db2:newdb2`，其中，`db1` 和 `db2` 为原数据库名     |
| REMAP_TABLE_LIST      | 待重命名的表，格式如下：`db1.t1:new_t1, db1.t2:db2.new_t2` 其中，`t1` 和 `t2` 为原表名        |
| REMAP_TABLEGROUP_LIST | 待重命名的表组，格式如下：`tg1:new_tg1, tg2:new_tg2` 其中，`tg1` 和 `tg2` 为原表组名    |
| REMAP_TABLESPACE_LIST | 待重命名的表空间，格式如下：`ts1:new_ts1, ts2:new_ts2` 其中，`ts1` 和 `ts2` 为原表组名    |
| TOTAL_TABLE_COUNT     | 需要导入的表的总数      |
| FINISHED_TABLE_COUNT  | 已经导入的表的数量     |
| FAILED_TABLE_COUNT    | 导入失败的表的数量       |
| RESULT                | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT               | 任务执行失败后，任务相关的报错信息                |
| DESCRIPTION           | 任务相关的描述                                  |

## CDB_OB_IMPORT_TABLE_TASKS

`CDB_OB_IMPORT_TABLE_TASKS` 展示表级别的扩租户导入任务的记录。

|  字段                          |  描述                          |
|-------------------------------|--------------------------------|
| TENANT_ID                     | 目标租户的租户 ID              |
| TASK_ID                       | 当前任务的 TASK_ID       |
| JOB_ID                        | 跨租户导入的 JOB_ID     |
| SRC_TENANT_ID                 | 源租户的租户 ID     |
| SRC_TABLESPACE                | 源表所属的表空间名       |
| SRC_TABLEGROUP                | 源表所属的表组名      |
| SRC_DATABASE                  | 源表所属的数据库名       |
| SRC_TABLE                     | 源表名    |
| SRC_PARTITION                 | 源表的分区名  |
| TARGET_TABLESPACE             | 重命名后的表空间名，如果未重命名，则显示为空     |
| TARGET_TABLEGROUP             | 重命名后的表组名，如果未重命名，则显示为空       |
| TARGET_DATABASE               | 重命名后的数据库名，如果未重命名，则显示为空      |
| TARGET_TABLE                  | 重命名后的表名，如果未重命名，则显示为空       |
| TABLE_COLUMN                  | 表的列名      |
| STATUS                        | 任务状态？      |
| START_TIMESTAMP               | 任务的开始时间，单位为纳秒     |
| COMPLETION_TIMESTAMP          | 任务的完成时间，单位为纳秒       |
| CUMULATIVE_TS                 |  ？     |
| TOTAL_INDEX_COUNT             |  表中索引的总数量     |
| IMPORTED_INDEX_COUNT          |  已导入的索引的数量     |
| FAILED_INDEX_COUNT            |  导入失败的索引数量      |
| TOTAL_CONSTRAINT_COUNT        |  表中约束的总数量     |
| IMPORTED_CONSTRAINT_COUNT     |  已导入的约束的数量     |
| FAILED_CONSTRAINT_COUNT       |  导入失败的约束的数量    |
| TOTAL_REF_CONSTRAINT_COUNT    |  ？     |
| IMPORTED_REF_CONSTRAINT_COUNT |   ？     |
| FAILED_REF_CONSTRAINT_COUNT   |    ？    |
| RESULT                        | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT                       | 任务执行失败后，任务相关的报错信息                |

## CDB_OB_IMPORT_TABLE_TASK_HISTORY

`CDB_OB_IMPORT_TABLE_TASK_HISTORY` 展示表级别的扩租户导入任务的历史记录。

|  字段                          |  描述                          |
|-------------------------------|--------------------------------|
| TENANT_ID                     | 目标租户的租户 ID              |
| TASK_ID                       | 当前任务的 TASK_ID       |
| JOB_ID                        | 跨租户导入的 JOB_ID     |
| SRC_TENANT_ID                 | 源租户的租户 ID     |
| SRC_TABLESPACE                | 源表所属的表空间名       |
| SRC_TABLEGROUP                | 源表所属的表组名      |
| SRC_DATABASE                  | 源表所属的数据库名       |
| SRC_TABLE                     | 源表名    |
| SRC_PARTITION                 | 源表的分区名  |
| TARGET_TABLESPACE             | 重命名后的表空间名，如果未重命名，则显示为空     |
| TARGET_TABLEGROUP             | 重命名后的表组名，如果未重命名，则显示为空       |
| TARGET_DATABASE               | 重命名后的数据库名，如果未重命名，则显示为空      |
| TARGET_TABLE                  | 重命名后的表名，如果未重命名，则显示为空       |
| TABLE_COLUMN                  | 表的列名      |
| STATUS                        | 任务状态？      |
| START_TIMESTAMP               | 任务的开始时间，单位为纳秒     |
| COMPLETION_TIMESTAMP          | 任务的完成时间，单位为纳秒       |
| CUMULATIVE_TS                 |  ？     |
| TOTAL_INDEX_COUNT             |  表中索引的总数量     |
| IMPORTED_INDEX_COUNT          |  已导入的索引的数量     |
| FAILED_INDEX_COUNT            |  导入失败的索引数量      |
| TOTAL_CONSTRAINT_COUNT        |  表中约束的总数量     |
| IMPORTED_CONSTRAINT_COUNT     |  已导入的约束的数量     |
| FAILED_CONSTRAINT_COUNT       |  导入失败的约束的数量    |
| TOTAL_REF_CONSTRAINT_COUNT    |  ？     |
| IMPORTED_REF_CONSTRAINT_COUNT |   ？     |
| FAILED_REF_CONSTRAINT_COUNT   |    ？    |
| RESULT                        | 任务完成的结果：<ul><li>`SUCCESS`：任务执行成功</li><li>`FAIL`：任务执行失败</li></ul>      |
| COMMENT                       | 任务执行失败后，任务相关的报错信息                |